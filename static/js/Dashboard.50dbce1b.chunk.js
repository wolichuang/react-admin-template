(this.webpackJsonpreact_antd_admin_template=this.webpackJsonpreact_antd_admin_template||[]).push([[1],{1408:function(e,t,a){},1460:function(e,t,a){"use strict";a.r(t);a(1307);var n=a(1310),i=(a(230),a(67)),o=(a(395),a(192)),r=a(37),l=a(168),c=a(169),s=a(397),d=a(171),u=a(170),f=(a(1323),a(1321)),h=a(0),m=a.n(h),p=(a(396),a(232)),g=(a(550),a(309)),b=(a(549),a(185)),v=(a(1311),a(1309)),y=a(117),C=a(303),E={name:"file",accept:".xls,.xlsx,.doc,.docx",showUploadList:!1,listType:"text"},w=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={visible:!1,confirmLoading:!1,loading:!1,verifyCode:"",fileList:[]},e.handleShowModal=function(){e.setState({visible:!0})},e.handleCancel=function(){e.setState({visible:!1}),e.props.form.setFieldsValue({file:"",verifyCode:""})},e.handleGetCode=function(){Object(C.i)().then((function(e){var t=e.data;200===t.resCode?o.a.success("\u9a8c\u8bc1\u7801\u53d1\u9001\u6210\u529f"):o.a.error(t.resMsg)})).catch((function(e){o.a.error(e.message)}))},e.beforeUpload=function(t){return e.setState((function(e){return{fileList:[].concat(Object(y.a)(e.fileList),[t])}})),!1},e.uploadChange=function(e){e.file.status,"done"===e.file.status?o.a.success("".concat(e.file.name," \u4e0a\u4f20\u6210\u529f")):"error"===e.file.status&&o.a.error("".concat(e.file.name," \u4e0a\u4f20\u5931\u8d25"))},e.handleImport=function(){var t=e.props,a=t.form,n=t.onReload,i=e.state.fileList,r=Object(s.a)(e);a.validateFields((function(e,t){if(!e){var a=t.verifyCode,l=new FormData;i.forEach((function(e){l.append("file",e)})),l.append("verifyCode",a),Object(C.j)(l).then((function(e){var t=e.data;200===t.resCode?(o.a.success("\u5bfc\u5165\u4fe1\u606f\u6210\u529f!"),r.setState({visible:!1,confirmLoading:!1}),n()):o.a.error(t.resMsg)})).catch((function(e){o.a.error(e.message)}))}}))},e}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.state,a=t.visible,n=t.confirmLoading,o={labelCol:{sm:{span:4}},wrapperCol:{sm:{span:20}}};return m.a.createElement(p.a,{title:"\u5bfc\u5165",visible:a,onCancel:this.handleCancel.bind(this),onOk:this.handleImport.bind(this),confirmLoading:n},m.a.createElement(b.a,o,m.a.createElement(b.a.Item,{label:"\u4e0a\u4f20Excel:","value-propName":"fileList"},e("file ",{rules:[{required:!0,message:"\u4e0a\u4f20Excel!"}]})(m.a.createElement(v.a,Object.assign({},E,{onChange:this.uploadChange.bind(this),beforeUpload:this.beforeUpload.bind(this)}),m.a.createElement(i.a,null,"Click to Upload")))),m.a.createElement(b.a.Item,{label:"\u9a8c\u8bc1\u7801:"},e("verifyCode",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801!"}]})(m.a.createElement("span",null,m.a.createElement(g.a,{placeholder:"\u9a8c\u8bc1\u7801",style:{width:"180px",marginRight:"20px"}}),m.a.createElement(i.a,{onClick:this.handleGetCode.bind(this)},"\u83b7\u53d6\u9a8c\u8bc1\u7801"))))))}}]),a}(h.Component),O=b.a.create({name:"ImportForm"})(w),S=(a(1408),f.a.Column),j=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),c=0;c<n;c++)i[c]=arguments[c];return(e=t.call.apply(t,[this].concat(i)))._isMounted=!1,e.state={list:[],loading:!1,total:0,listQuery:{pageNo:1,pageSize:10}},e.fetchData=function(){e.setState({loading:!0}),Object(C.f)(e.state.listQuery).then((function(t){var a=t.data;if(e.setState({loading:!1}),a.body&&a.body.total){var n=a.body.list,i=a.body.total;e._isMounted&&e.setState({list:n,total:i})}}))},e.changePage=function(t,a){e.setState((function(e){return{listQuery:Object(r.a)({},e.listQuery,{pageNo:t})}}),(function(){e.fetchData()}))},e.changePageSize=function(t,a){e.setState((function(e){return{listQuery:Object(r.a)({},e.listQuery,{pageNo:1,pageSize:a})}}),(function(){e.fetchData()}))},e.handleDelete=function(t){var a=Object(s.a)(e),n=new FormData;n.append("cardNo",t.cardNo),Object(C.b)(n).then((function(e){o.a.success("\u5220\u9664\u63d0\u8d27\u5361\u6210\u529f"),a.fetchData()}))},e.uploadChange=function(t){e.formImportRef.handleShowModal()},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.fetchData()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this;return m.a.createElement("div",{className:"app-container"},m.a.createElement("div",{className:"normal-options",key:Math.random()},m.a.createElement(i.a,{onClick:this.uploadChange.bind(this)},"\u5bfc\u5165\u5361\u53f7\uff08\u5bfc\u5165Excel\uff09")),m.a.createElement("div",{className:"vspace"}),m.a.createElement(f.a,{rowKey:function(e){return e.cardNo},dataSource:this.state.list,loading:this.state.loading,pagination:!1,className:"normal-table",size:"small"},m.a.createElement(S,{title:"\u5361\u53f7",dataIndex:"cardNo",key:"cardNo",width:200,align:"center"}),m.a.createElement(S,{title:"\u4ef7\u683c",dataIndex:"price",key:"price",width:100,align:"center"}),m.a.createElement(S,{title:"\u8ba2\u5355\u53f7",dataIndex:"orderNo",key:"orderNo",width:200,align:"center"}),m.a.createElement(S,{title:"\u662f\u5426\u5df2\u7ed1\u5b9a\u8ba2\u5355",key:"used",width:100,align:"center",render:function(e,t){return e.used?"\u5df2\u7ed1\u5b9a":"\u672a\u7ed1\u5b9a"}}),m.a.createElement(S,{title:"\u64cd\u4f5c",key:"action",width:195,align:"center",render:function(t,a){return m.a.createElement("span",null,m.a.createElement(i.a,{type:"primary",shape:"circle",icon:"delete",title:"\u5220\u9664",onClick:e.handleDelete.bind(null,a)}))}})),m.a.createElement("div",{className:"normal-pages"},m.a.createElement(n.a,{size:"small",total:this.state.total,pageSizeOptions:["10","20","40"],showTotal:function(e){return"\u5171".concat(e,"\u6761\u6570\u636e")},onChange:this.changePage,current:this.state.listQuery.pageNo,onShowSizeChange:this.changePageSize,showSizeChanger:!0,showQuickJumper:!0,hideOnSinglePage:!0})),m.a.createElement(O,{wrappedComponentRef:function(t){return e.formImportRef=t},onReload:this.fetchData,ref:"importForm"}))}}]),a}(h.Component);t.default=j}}]);