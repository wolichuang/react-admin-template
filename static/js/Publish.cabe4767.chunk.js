(this.webpackJsonpreact_antd_admin_template=this.webpackJsonpreact_antd_admin_template||[]).push([[4],{1453:function(e,a,t){},1459:function(e,a,t){"use strict";t.r(a);t(1307);var i=t(1310),n=(t(1318),t(1320)),s=(t(230),t(67)),r=t(37),l=(t(395),t(192)),o=t(168),c=t(169),d=t(171),m=t(170),g=(t(1323),t(1321)),u=t(0),p=t.n(u),h=t(303),f=(t(396),t(232)),b=(t(1311),t(1309)),v=(t(549),t(185)),E=t(397),D=(t(550),t(309)),y=t(1461),C=t(1462),N=D.a.TextArea,S={name:"file",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,multiple:!1,action:Object(h.l)(),beforeUpload:function(e){var a="image/jpeg"===e.type||"image/png"===e.type;a||l.a.error("\u53ea\u80fd\u4f20 png, jpg \u56fe\u7247");var t=e.size/1024/1024<2;return t||l.a.error("\u56fe\u7247\u5927\u5c0f\u5c0f\u4e8e 2MB!"),a&&t}},L=function(e){Object(d.a)(t,e);var a=Object(m.a)(t);function t(){var e;Object(o.a)(this,t);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=a.call.apply(a,[this].concat(n))).state={visible:!1,confirmLoading:!1,loading:!1,imgDtoId:0,goodsNo:0,imagePath:"",imgDtoList:[],goodsName:"",goodsDesc:"",price:0},e.onReset=function(){e.props.form.resetFields(),e.setState({imagePath:"",imgDtoList:[]})},e.handleShowModal=function(){e.setState({visible:!0}),e.onReset()},e.handleCancel=function(){e.setState({visible:!1})},e.handleBigChange=function(a){if("uploading"!==a.file.status){if("done"===a.file.status){var t=a.file.response;if(200===t.resCode){var i=t.body.picKey;e.setState({imagePath:i}),e.props.form.setFieldsValue({imagePath:i}),l.a.success(t.resMsg)}else l.a.error(t.resMsg)}"error"===a.file.status&&l.a.error("".concat(a.file.name," file upload failed."))}},e.handleUploadChange=function(a){if("uploading"!==a.file.status){if("done"===a.file.status){var t=a.file.response,i=e.state,n=i.imgDtoId,s=i.imgDtoList;if(200===t.resCode){var r=t.body.picKey;e.setState({imgDtoId:n+1}),s.push({id:e.state.imgDtoId,imagePath:r}),e.setState({imgDtoList:s,loading:!1}),e.props.form.setFieldsValue({imgDtoList:s}),l.a.success(t.resMsg)}else l.a.error(t.resMsg)}"error"===a.file.status&&l.a.error("".concat(a.file.name," file upload failed."))}else e.setState({loading:!0})},e.handlePublish=function(){var a=e.props,t=a.form,i=a.onReload,n=Object(E.a)(e);t.validateFields((function(a,t){if(!a){var s=t.goodsName,r=t.goodsDesc,o=t.imagePath,c=t.price,d=t.imgDtoList;e.setState({addModalLoading:!0}),Object(h.m)({goodsName:s,price:c,goodsDesc:r,imagePath:o,imgDtoList:d}).then((function(e){var a=e.data;200===a.resCode?(l.a.success("\u65b0\u589e\u5546\u54c1\u6210\u529f!"),n.setState({visible:!1,confirmLoading:!1}),i()):l.a.error(a.resMsg)})).catch((function(e){l.a.error(e.message)}))}}))},e}return Object(c.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,a=this.state,t=a.loading,i=a.visible,n=a.confirmLoading,s=this.state,r=s.goodsName,l=s.goodsDesc,o=s.price,c=s.imagePath,d=s.imgDtoList,m={labelCol:{sm:{span:4}},wrapperCol:{sm:{span:20}}},g=p.a.createElement("div",null,t?p.a.createElement(y.a,null):p.a.createElement(C.a,null),p.a.createElement("div",{style:{marginTop:8}},"\u4e0a\u4f20\u56fe\u7247")),u=d&&d.map((function(e){var a="imageDo-".concat(e.id),t=h.p+e.imagePath;return p.a.createElement("span",{key:a},p.a.createElement("img",{src:t,alt:"avatar",id:a,style:{width:"100px",height:"100px"}}))}));return p.a.createElement(f.a,{title:"\u53d1\u5e03\u5546\u54c1",visible:i,onCancel:this.handleCancel.bind(this),onOk:this.handlePublish.bind(this),confirmLoading:n},p.a.createElement(v.a,m,p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u540d\u79f0:"},e("goodsName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u540d\u79f0!"}],initialValue:r})(p.a.createElement(D.a,{placeholder:"\u5546\u54c1\u540d\u79f0"}))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u7b80\u4ecb:"},e("goodsDesc",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u7b80\u4ecb!"}],initialValue:l})(p.a.createElement(N,{placeholder:"\u5546\u54c1\u7b80\u4ecb"}))),p.a.createElement(v.a.Item,{label:"\u4ef7\u683c:"},e("price",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ef7\u683c!"}],initialValue:o})(p.a.createElement(D.a,{placeholder:"\u4ef7\u683c",type:"number"}))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u4e3b\u56fe:"},e("imagePath",{rules:[{required:!0,message:"\u8bf7\u4e0a\u4f20\u5546\u54c1\u4e3b\u56fe!"}]})(p.a.createElement("div",{className:"ImageSingle"},c?p.a.createElement("span",null,p.a.createElement("img",{src:h.p+c,alt:"avatar"})):"",p.a.createElement(b.a,Object.assign({},S,{onChange:this.handleBigChange.bind(this)}),g)))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u8be6\u60c5:"},e("imgDtoList",{rules:[{required:!0,message:"\u8bf7\u4e0a\u4f20\u5546\u54c1\u8be6\u60c5!"}]})(p.a.createElement("div",{className:"uploadList"},p.a.createElement("div",{className:"imageList"},u.length>0?u:""),p.a.createElement(b.a,Object.assign({},S,{onChange:this.handleUploadChange.bind(this)}),g))))))}}]),t}(u.Component),j=v.a.create({name:"AddForm"})(L),O=D.a.TextArea,I={name:"file",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,multiple:!1,action:Object(h.l)(),beforeUpload:function(e){var a="image/jpeg"===e.type||"image/png"===e.type;a||l.a.error("\u53ea\u80fd\u4f20 png, jpg \u56fe\u7247");var t=e.size/1024/1024<2;return t||l.a.error("\u56fe\u7247\u5927\u5c0f\u5c0f\u4e8e 2MB!"),a&&t}},P=function(e){Object(d.a)(t,e);var a=Object(m.a)(t);function t(){var e;Object(o.a)(this,t);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=a.call.apply(a,[this].concat(n))).state={visible:!1,confirmLoading:!1,loading:!1,imgDtoId:0,goodsNo:0,imagePath:"",imageAbsUrl:"",imgDtoList:[],goodsName:"",goodsDesc:"",price:0},e.resetImage=function(a){e.setState(Object(r.a)({},a))},e.handleBigChange=function(a){if("uploading"!==a.file.status){if("done"===a.file.status){var t=a.file.response;if(200===t.resCode){var i=t.body.picKey;e.setState({imagePath:i}),e.props.form.setFieldsValue({imagePath:i}),l.a.success(t.resMsg)}else l.a.error(t.resMsg)}"error"===a.file.status&&l.a.error("".concat(a.file.name," file upload failed."))}},e.handleUploadChange=function(a){if("uploading"!==a.file.status){if("done"===a.file.status){var t=a.file.response,i=e.state,n=i.imgDtoId,s=i.imgDtoList;if(null===s&&(s=[]),200===t.resCode){var r=t.body.picKey;e.setState({imgDtoId:n+1}),s.push({id:e.state.imgDtoId,imagePath:r}),e.setState({loading:!1,imgDtoList:s}),e.props.form.setFieldsValue({imgDtoList:s}),l.a.success(t.resMsg)}else l.a.error(t.resMsg)}"error"===a.file.status&&l.a.error("".concat(a.file.name," file upload failed."))}else e.setState({loading:!0})},e.handleEditPublish=function(){var a=e.props,t=a.form,i=a.onReload,n=Object(E.a)(e);t.validateFields((function(e,a){if(!e){var t=a.goodsNo,s=a.goodsName,r=a.goodsDesc,o=a.imagePath,c=a.price,d=a.imgDtoList,m=o.includes(h.p)>-1?o.replace(h.p,""):o;Object(h.q)({goodsNo:t,goodsName:s,price:c,goodsDesc:r,imagePath:m,imgDtoList:d}).then((function(e){var a=e.data;200===a.resCode?(l.a.success("\u4fee\u6539\u5546\u54c1\u4fe1\u606f\u6210\u529f!"),n.setState({visible:!1,confirmLoading:!1}),i()):l.a.error(a.resMsg)})).catch((function(e){l.a.error(e.message)}))}}))},e.handleEditCancel=function(){e.setState({confirmLoading:!1,visible:!1})},e.handleDelImage=function(a){var t;t=e.state.imgDtoList.filter((function(e){return e.id!==a})),e.setState({imgDtoList:t}),e.props.form.setFieldsValue({imgDtoList:t})},e}return Object(c.a)(t,[{key:"InitData",value:function(e){this.setState(Object(r.a)({},e,{visible:!0}))}},{key:"render",value:function(){var e=this,a=this.props.form.getFieldDecorator,t=this.state.loading,i=this.state,n=i.visible,s=i.confirmLoading,r=i.goodsNo,l=i.goodsName,o=i.goodsDesc,c=i.price,d=i.imagePath,m=i.imgDtoList,g=this.state.imageAbsUrl;d&&(g=h.p+d);var u={labelCol:{sm:{span:4}},wrapperCol:{sm:{span:20}}},E=p.a.createElement("div",null,t?p.a.createElement(y.a,null):p.a.createElement(C.a,null),p.a.createElement("div",{style:{marginTop:8}},"\u4e0a\u4f20\u56fe\u7247")),N=m&&m.map((function(a){var t="imageDo-".concat(a.id),i=h.p+a.imagePath;return p.a.createElement("span",{key:t},p.a.createElement("img",{src:i,alt:"avatar",id:t,style:{width:"90px",height:"90px"}}),p.a.createElement("i",{className:"icon-del",onClick:e.handleDelImage.bind(e,a.id)},"\xa0"))}));return p.a.createElement(f.a,{title:"\u7f16\u8f91\u5546\u54c1",visible:n,onCancel:this.handleEditCancel.bind(this),onOk:this.handleEditPublish.bind(this),confirmLoading:s},p.a.createElement(v.a,u,a("goodsNo",{initialValue:r})(p.a.createElement(D.a,{type:"hidden"})),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u540d\u79f0:"},a("goodsName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u540d\u79f0!"}],initialValue:l})(p.a.createElement(D.a,{placeholder:"\u5546\u54c1\u540d\u79f0"}))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u7b80\u4ecb:"},a("goodsDesc",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u7b80\u4ecb!"}],initialValue:o})(p.a.createElement(O,{placeholder:"\u5546\u54c1\u7b80\u4ecb"}))),p.a.createElement(v.a.Item,{label:"\u4ef7\u683c:"},a("price",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ef7\u683c!"}],initialValue:c})(p.a.createElement(D.a,{placeholder:"\u4ef7\u683c",type:"number"}))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u4e3b\u56fe:"},a("imagePath",{rules:[{required:!0,message:"\u8bf7\u4e0a\u4f20\u5546\u54c1\u4e3b\u56fe!"}],initialValue:g})(p.a.createElement("div",{className:"ImageSingle"},p.a.createElement("span",null,p.a.createElement("img",{src:g,alt:"avatar"})),p.a.createElement(b.a,Object.assign({},I,{onChange:this.handleBigChange.bind(this)}),E)))),p.a.createElement(v.a.Item,{label:"\u5546\u54c1\u8be6\u60c5:"},a("imgDtoList",{initialValue:m})(p.a.createElement("div",{className:"uploadList"},p.a.createElement("div",{className:"imageList"},N&&N.length>0?N:""),p.a.createElement(b.a,Object.assign({},I,{onChange:this.handleUploadChange.bind(this)}),E))))))}}]),t}(u.Component),k=v.a.create({name:"EditForm"})(P),M=(t(1453),g.a.Column),w=function(e){Object(d.a)(t,e);var a=Object(m.a)(t);function t(){var e;Object(o.a)(this,t);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=a.call.apply(a,[this].concat(n)))._isMounted=!1,e.state={list:[],loading:!1,total:0,listQuery:{pageNo:1,pageSize:10}},e.fetchData=function(){var a=[],t=0;e.setState({loading:!0}),Object(h.g)(e.state.listQuery).then((function(i){e.setState({loading:!1});var n=i.data;200===n.resCode?(a=n.body.list,t=n.body&&n.body.total):l.a.error(n.resMsg),e._isMounted&&e.setState({list:a,total:t})}))},e.changePage=function(a,t){e.setState((function(e){return{listQuery:Object(r.a)({},e.listQuery,{pageNo:a})}}),(function(){e.fetchData()}))},e.changePageSize=function(a,t){e.setState((function(e){return{listQuery:Object(r.a)({},e.listQuery,{pageNo:a,pageSize:t})}}),(function(){e.fetchData()}))},e.handleDelete=function(a){var t={goodsNo:a.goodsNo};Object(h.c)(t).then((function(a){var t=a.data;200===t.resCode?(l.a.success("\u5220\u9664\u5546\u54c1\u6210\u529f"),e.fetchData()):l.a.error(t.resMsg)}))},e.handleAdd=function(){e.formAddRef.handleShowModal()},e.handleEdit=function(a){e.formEditRef.InitData(a)},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.fetchData()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this;return p.a.createElement("div",{className:"app-container"},p.a.createElement("div",{className:"normal-options"},p.a.createElement(s.a,{onClick:this.handleAdd.bind(this)},"\u53d1\u5e03\u5546\u54c1")),p.a.createElement("div",{className:"vspace"}),p.a.createElement("div",{className:"goods-table"},p.a.createElement(g.a,{rowKey:function(e){return e.goodsNo},dataSource:this.state.list,loading:this.state.loading,pagination:!0,className:"normal-table",size:"small"},p.a.createElement(M,{title:"\u5546\u54c1\u540d\u79f0",dataIndex:"goodsName",key:"goodsName",align:"center"}),p.a.createElement(M,{title:"\u5546\u54c1\u7b80\u4ecb",dataIndex:"goodsDesc",key:"goodsDesc",align:"center"}),p.a.createElement(M,{title:"\u4ef7\u683c",dataIndex:"price",key:"price",align:"center",render:function(e,a,t){return e+"$"}}),p.a.createElement(M,{title:"\u5546\u54c1\u4e3b\u56fe",dataIndex:"imagePath",align:"center",render:function(e,a){return p.a.createElement("span",null,p.a.createElement("div",{className:"border-image"},p.a.createElement("img",{src:h.p+a.imagePath,alt:""})))}}),p.a.createElement(M,{title:"\u72b6\u6001",dataIndex:"status",key:"status",align:"center"}),p.a.createElement(M,{title:"\u64cd\u4f5c",key:"action",align:"center",render:function(a,t){return p.a.createElement("span",null,p.a.createElement(s.a,{type:"primary",shape:"circle",icon:"edit",title:"\u7f16\u8f91",onClick:e.handleEdit.bind(null,t)}),p.a.createElement(n.a,{type:"vertical"}),p.a.createElement(s.a,{type:"primary",shape:"circle",icon:"delete",title:"\u5220\u9664",onClick:e.handleDelete.bind(null,t)}))}}))),p.a.createElement("div",{className:"normal-pages"},p.a.createElement(i.a,{size:"small",total:this.state.total,pageSizeOptions:["10","20","40"],showTotal:function(e){return"\u5171".concat(e,"\u6761\u6570\u636e")},onChange:this.changePage,current:this.state.listQuery.pageNo,onShowSizeChange:this.changePageSize,showSizeChanger:!0,showQuickJumper:!0,hideOnSinglePage:!0})),p.a.createElement(j,{wrappedComponentRef:function(a){return e.formAddRef=a},onReload:this.fetchData,ref:"addForm"}),p.a.createElement(k,{wrappedComponentRef:function(a){return e.formEditRef=a},onReload:this.fetchData,ref:"editForm"}))}}]),t}(u.Component);a.default=w}}]);